{% load static %}
{% load i18n %}

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}CMS{% endblock %}</title>

  <link rel="stylesheet" href="{% static 'cms/cms.css' %}">
  <script src="{% static 'cms/cms.js' %}" defer></script>
  <script src="https://unpkg.com/htmx.org@2.0.2"></script>

  {# Hide skip link by default; show on focus for accessibility #}
  <style>
    .skip-link {
      position: absolute;
      left: -10000px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .skip-link:focus {
      position: fixed;
      left: 12px;
      top: 12px;
      width: auto;
      height: auto;
      padding: .5rem .75rem;
      background: #111;
      color: #fff;
      border-radius: 6px;
      z-index: 10000;
    }
  </style>

  {% block extra_head %}{% endblock %}
</head>
<body class="cms {% if request.user.is_superuser %}role-superuser{% else %}role-user{% endif %}">
  <a href="#main" class="skip-link">Skip to content</a>

  {# --- Impersonation banner --- #}
  {% if request.impersonating %}
    <div class="impersonation-banner" role="status" aria-live="polite" style="background:#ffd966; color:#222; padding:.7rem .75rem; right: 0; z-index: 10000; position: fixed; display:flex; gap:.5rem; align-items:center;">
      <strong>{% trans "Impersonating" %}:</strong>
      <span>{{ request.user.get_username }}</span>
      <span style="margin-left:auto;">
        <a href="{% url 'users:impersonate_stop' %}" class="btn btn-sm btn-outline-dark">{% trans "Stop" %}</a>
      </span>
    </div>
  {% endif %}
 
  <!-- mobile overlay -->
  <div class="backdrop" data-nav-close></div>

  <aside id="cmsSide" class="cms-nav" role="navigation" aria-label="CMS">
    {% include "cms/nav.html" %}
  </aside>

  <main id="main" class="cms-main">
    <header class="cms-top">
      <div class="left">
        <button id="navToggle" class="iconbtn" aria-label="Toggle menu" aria-controls="cmsSide" aria-expanded="false">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M3 6h18M3 12h18M3 18h18"/>
          </svg>
        </button>
        <a class="brand" href="/">Bar OS</a>
      </div>
      <div class="right">
        {% if user.is_authenticated %}
          <form method="post" action="{% url 'logout' %}" style="display:inline">
            {% csrf_token %}
            <button type="submit" class="linklike">{% trans "Logout" %}</button>
          </form>
        {% else %}
          <a href="{% url 'login' %}">{% trans "Login" %}</a>
        {% endif %}
      </div>
    </header>

    {% if messages %}
      <div class="messages" style="padding:8px 12px;">
        {% for message in messages %}
          <div class="alert {{ message.tags }}" role="alert" style="margin:.25rem 0;">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <section class="cms-content">
      {% block content %}{% endblock %}
    </section>
  </main>

  {% block extra_body %}{% endblock %}
</body>
</html>
