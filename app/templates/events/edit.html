{% extends "cms/base_cms.html" %}
{% load static setup_tags %}

{% block title %}Edit Event &middot; {{ event.title }}{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'events/events.css' %}">
{% endblock %}

{% block extra_body %}
  <script src="{% static 'events/events.js' %}" defer></script>
{% endblock %}

{% block content %}
<section class="module-header">
  <div>
    <h1>Edit event</h1>
    <p class="sub">{{ event.title }}</p>
  </div>
  <div class="actions">
    <form method="post" action="{% url 'events:delete' event.slug %}" style="display:inline" onsubmit="return confirm('Delete this event?');">
      {% csrf_token %}
      <button type="submit" class="btn btn-outline btn-danger">Delete</button>
    </form>
    <a class="btn btn-outline" href="{% url 'events:detail' event.slug %}">Preview</a>
    <a class="btn btn-outline" href="{% url 'events:index' %}">Back to list</a>
  </div>
</section>

<form method="post" enctype="multipart/form-data" action="" class="page-form">
  {% csrf_token %}
  <div id="event-edit-body">
    {% include "events/partials/event_form_body.html" with event_form=event_form performer_formset=performer_formset %}
  </div>
  <div class="page-actions">
    <button type="submit" class="btn btn-primary">Save changes</button>
    <a class="btn btn-outline" href="{% url 'events:index' %}">Cancel</a>
  </div>
</form>

<section class="related-section">
  <h2>Associated shifts</h2>
  {% with shift_list=event.shifts.all %}
  {% if shift_list %}
    <table class="data-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Start</th>
          <th>End</th>
          <th>Slot</th>
          <th>Filled</th>
        </tr>
      </thead>
      <tbody>
        {% for shift in shift_list %}
          <tr>
            <td>{{ shift.title }}</td>
            <td>{{ shift.start_at|date:"Y-m-d H:i" }}</td>
            <td>{{ shift.end_at|date:"Y-m-d H:i" }}</td>
            <td>{{ shift.template_segment }} / {{ shift.template_staff_position }}</td>
            <td>{{ shift.slots_taken }}/{{ shift.capacity }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="empty">No shifts generated yet. Enable "Requires shifts" and save to apply a standard template.</p>
  {% endif %}
  {% endwith %}
</section>
{% endblock %}
