{% extends "cms/base_cms.html" %}
{% load static %}

{% block title %}Event Preview · {{ event.title }}{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'events/events.css' %}">
{% endblock %}

{% block content %}
<section class="module-header">
  <div>
    <h1>{{ event.title }}</h1>
    <p class="sub">Preview of structured event data.</p>
  </div>
  <div class="actions">
    <a class="btn btn-outline" href="{% url 'events:edit' event.slug %}">Edit</a>
    <a class="btn btn-outline" href="{% url 'events:index' %}">Back to list</a>
  </div>
</section>

<article class="event-preview">
  {% if event.hero_image %}
    <img class="hero" src="{{ event.hero_image.url }}" alt="Poster for {{ event.title }}">
  {% endif %}
  <dl class="kv">
    <dt>Status</dt><dd>{{ event.get_status_display }}</dd>
    <dt>Starts</dt><dd>{{ event.starts_at|date:"Y-m-d H:i" }}</dd>
    <dt>Doors</dt><dd>{% if event.doors_at %}{{ event.doors_at|date:"Y-m-d H:i" }}{% else %}—{% endif %}</dd>
    <dt>Ends</dt><dd>{% if event.ends_at %}{{ event.ends_at|date:"Y-m-d H:i" }}{% else %}—{% endif %}</dd>
    <dt>Location</dt><dd>{{ event.venue_name }} · {{ event.venue_address }} {{ event.venue_postal_code }} {{ event.venue_city }} {{ event.venue_country }}</dd>
    <dt>Ticketing</dt>
    <dd>
      {% if event.is_free %}
        Free entry
      {% else %}
        {% if event.ticket_price_from %}
          €{{ event.ticket_price_from }}{% if event.ticket_price_to %}–€{{ event.ticket_price_to }}{% endif %}
        {% else %}
          —
        {% endif %}
      {% endif %}
      {% if event.ticket_url %}<div><a href="{{ event.ticket_url }}" target="_blank" rel="noopener">Ticket link</a></div>{% endif %}
    </dd>
    <dt>Categories</dt>
    <dd>
      {% for cat in event.categories.all %}
        <span class="pill">{{ cat.name }}</span>
      {% empty %}
        <span class="quiet">None</span>
      {% endfor %}
    </dd>
  </dl>
  <section>
    <h2>Public description</h2>
    <div class="prose">{{ event.description_public|linebreaks }}</div>
  </section>
  <section>
    <h2>Performers</h2>
    <ul class="performer-list">
      {% for slot in event.performers.all %}
        <li>
          <strong>{{ slot.display_name }}</strong>
          {% if slot.slot_starts_at %}<span> · {{ slot.slot_starts_at|date:"H:i" }}{% if slot.slot_ends_at %}–{{ slot.slot_ends_at|date:"H:i" }}{% endif %}</span>{% endif %}
          {% if slot.performer_type %}<span class="quiet">({{ slot.performer_type }})</span>{% endif %}
        </li>
      {% empty %}
        <li class="quiet">No performers listed.</li>
      {% endfor %}
    </ul>
  </section>
</article>
{% endblock %}
