{% load setup_tags %}
{% include "events/partials/_form_errors.html" with form=event_form %}
{{ performer_formset.management_form }}
{% if performer_formset.non_form_errors %}
  <div class="form-errors">
    <ul>
      {% for error in performer_formset.non_form_errors %}
        <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

{% for hidden in event_form.hidden_fields %}{{ hidden }}{% endfor %}

<div class="form-grid">
  {% for title, fields, opts in event_form.render_fieldsets %}
    <details class="form-section" {% if opts.open %}open{% endif %}>
      <summary>
        {{ title }}
        {% if title == "Visibility" %}
          {% visibility_cog_inline 'cms.events.visibility' 'Event visibility' %}
        {% elif title == "Shifts" %}
          {% visibility_cog_inline 'cms.shifts.settings' 'Event shifts' %}
        {% endif %}
      </summary>
      <div class="section-body">
        {% for field in fields %}
          {% if field.name == 'standard_shifts' and event_form.standard_shift_count == 0 %}
            <div class="form-field" data-field-name="standard_shifts">
              <label>Standard shifts</label>
              <p class="help">No standard shifts defined yet. Head to the <a href="{% url 'shifts:index' %}" target="_blank" rel="noopener">Shift planner</a> to create them.</p>
            </div>
          {% else %}
            {% include "events/partials/_field.html" with field=field %}
          {% endif %}
        {% endfor %}
      </div>
    </details>
  {% endfor %}
</div>

<details class="form-section" open>
<summary>Performers {% visibility_cog_inline 'cms.events.performers' 'Event performers' %}</summary>
  <div class="section-body">
    <table class="performer-table" data-performer-table>
      <thead>
        <tr>
          <th>Band</th>
          <th>Quick add</th>
          <th>Display name</th>
          <th>Type</th>
          <th>Slot start</th>
          <th>Slot end</th>
          <th>Order</th>
          <th>Notes</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        {% for form in performer_formset.forms %}
          {% include "events/partials/_performer_row.html" with form=form %}
        {% endfor %}
      </tbody>
    </table>
    <template id="performer-empty-template">
      {% include "events/partials/_performer_row.html" with form=performer_formset.empty_form %}
    </template>
    <div class="table-actions">
      <button type="button" class="btn btn-outline" data-add-performer>+ Add performer</button>
    </div>
  </div>
</details>
